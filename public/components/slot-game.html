<div>
  <!-- SLOT GAME <span u-text="rows"></span> x <span u-text="cols"></span> -->
  SLOT GAME <span u-text="`${rows} x ${cols}`"></span>

  <template u-for="i in 3">
    <template u-for="j in 3">
      <div u-text="i"></div>
    </template>
  </template>
</div>

<main u-bind:style="{'--rows': rows, '--cols': cols}">
  <section u-for="cell in cellList">
    <slot u-bind:name="cell">
      <div u-text="cell"></div>
    </slot>
  </section>
</main>

<script>
  export function $props() {
    return {
      rows: {
        default: 2,
        cast: parseInt,
      },
      cols: {
        default: 2,
        cast: parseInt,
      }
    }
  }

  export function $store() {
    return {
      // rows: 4,
      // cols: 3,
      cellList: [],
    }
  }

  export function mkblah($data) {
    return this.$computed(() => {
      const cellList = []
      for (let i = 0; i < $data.rows; i++) {
        for (let j = 0; j < $data.cols; j++) {
          cellList.push(`${i}:${j}`)
        }
      }
      return [...cellList]
    })
  }

  export async function connectedCallback({root}) {
    const {$data} = this


    // const blah = this.$computed(() => {
    //   const cellList = []
    //   for (let i = 0; i < $data.rows; i++) {
    //     for (let j = 0; j < $data.cols; j++) {
    //       cellList.push(`${i}:${j}`)
    //     }
    //   }
    //   return [...cellList]
    // })

    // const blah = this.mkblah($data)

    // this.$effect(() => {
    //   console.log('blah: ', blah())
    // })


//     this.$effect(() => {
// console.log('$effect: 1')

//       this.$nextTick().then(() => {
//         // await this.$nextTick()
//   console.log('$effect: 2')

//   console.log($data.rows, $data.cols)

//         const cellList = []
//         for (let i = 0; i < $data.rows; i++) {
//           for (let j = 0; j < $data.cols; j++) {
//             cellList.push(`${i}:${j}`)
//           }
//         }
//   console.log('cellList: ', cellList.length)

//         $data.cellList = [...cellList]

//       })
//     })


    this.$effect(async () => {
console.log('$effect: 1')
      // await this.$nextTick()
console.log('$effect: 2')


console.log($data.rows, $data.cols)

      const cellList = []
      for (let i = 0; i < $data.rows; i++) {
        for (let j = 0; j < $data.cols; j++) {
          cellList.push(`${i}:${j}`)
        }
      }
console.log('cellList: ', cellList.length)

      $data.cellList = [...cellList]
    })
  }
</script>

<style>
  :host {
    font-family: monospace;
  }

  ::slotted([slot]), slot > :first-child {
    display: inline-block;
    box-sizing: border-box;
    text-align: center;
    width: 50px;
    height: 50px;

  }

  main {
    display: inline-grid;
    grid-template-rows: repeat(var(--rows), 100px);
    grid-template-columns: repeat(var(--cols), minmax(100px, 1fr));

    border-top: 1px solid black;
    border-left: 1px solid black;
    gap: 0px;

    & > section {
      box-sizing: border-box;
      width: 100px;
      height: 100px;
      padding: 25px;
      background-color: white;

      border-bottom: 1px solid black;
      border-right: 1px solid black;
      place-self: stretch;
    }
  }
</style>
